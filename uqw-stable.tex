
\section{From uniform quasi-wideness to stability}\label{sec:stable}
As mentioned, Adler and Adler~\cite{adler2014interpreting}, 
proved that every nowhere dense class of graphs is stable. In this section,
we prove its effective variant,~\cref{thm:new-stable}, which 
we repeat for convenience.
\setcounter{theorem}{1}
\begin{theorem}
  There are computable functions $f\colon \N^3\to\N$ and $g\colon\N\to\N$ with the following property.
Suppose $\phi(\bar x,\bar y)$ is a formula of quantifier rank $q$ and with $d$ free variables,
and $G$ is a graph such that $K_t\not\minor_{g(q)} G$. Then the ladder index of $\phi(\bar x,\bar y)$ in $G$ is at most $f(q,d,t)$.
\end{theorem}


% and its effective variant,~\cref{thm:new-stable}.
% \setcounter{theorem}{1}
% \begin{theorem}%\label{thm:uqw-stable}
% 	Let $\cal C$ be a uniformly quasi-wide class of graphs.
% 	Then $\cal C$ is stable. % More precisely, if $\phi(\bar u,\bar v)$ is a formula with $d$ free variables and quantifier rank $q$, and $N^d(r,m)$ and $s^d(r)$ are as in Proposition~\ref{prop:uqw-tuples}, then for all graphs $G\in\cal C$,  the ladder index of $\phi$ is at most $N^d(2r,(2T)^d)$,
% % where $r= 7^q$,
% %  $T$ is the number of all quantifier rank $q$ types with one free  variable over the signature of  graphs colored with $s^d(2r)$ colors.
% %\marginpar{shall we recall the definition of stability and ladders?}
% \end{theorem}

Recall that a class $\cal C$ is stable if and only if for every first order formula $\varphi(\bar x,\bar y)$, its ladder index over graphs from $\cal C$ is bounded by a constant depending only on $\cal C$ and $\varphi$;
see \cref{sec:intro} to recall the background on stability.
Thus the result of Adler and Adler is implied by \cref{thm:new-stable} (stated in \cref{sec:intro}), and is weaker in the following sense: \cref{thm:new-stable} asserts in addition that there is a computable bounds on the ladder index
of any formula that depends only on the size of an excluded clique minor on a levels bounded in terms of formula's quantifier rank and number of free variables. 
We now prove~\cref{thm:new-stable}.

\begin{proof}%[of \cref{thm:uqw-stable}]
Fix a formula $\phi(\bar y,\bar z)$ of quantifier rank $q$ and
a partitioning of its 
free variables $\bar x$ into  $\bar y$ and $\bar z$.
Let $d=|\bar x|=|\bar y|+|\bar z|$.
Let $r\in \N$ be the number given by~\cref{cor:bound},
which depends on $\phi$ only.
Let $\cal C$ be the class of all graphs 
such that  $K_t\not\minor_{18r} G$.
Then, by~\cref{thm:uqw-tuples}, 
$\cal C$ satisfies $\uqw^d_{r}(N^d_{r},s^d_r)$,
for some  polynomial  $N^d_r\from\N\to\N$ and number $s=s^d_r\in \N$ computable from $d,t,r$.
Let $T$ be the number given by~\cref{cor:bound},
which depends on $\phi$ and $s$.
 Finally, let 
$\ell=N^d_r(T+1)$.
  %Let $s=s^d_{2r}$, and 
% Let $p,r\in \N$ be the numbers given by \cref{lem:types}, and let
% $T(\cdot,\cdot,\cdot)$ be the function given by \cref{lem:types}.
We show that 
every $\phi$-ladder in a graph $G\in\cal C$ has length less than $\ell$.


For the sake of contradiction, assume that there is a graph $G\in\cal C$, a number $k\ge  \ell$,
and tuples $\bar u_1,\ldots,\bar u_k\in V(G)^{|\bar y|}$ and $ \bar v_1,\ldots, \bar v_k\in V(G)^{|\bar z|}$
which form a $\phi$-ladder in $G$, i.e., 
$\phi(\bar u_i,\bar v_j)$ holds in $G$ if and only if $i\le j$.
% Denote $\bar w_i=\bar u_i \bar v_i$, for $i=1,\ldots,k$.
	Let $A=\setof{ \bar u_i \bar v_i}{i=1,\ldots,k}\subset V(G)^d$; note that $|A|\ge N^d_r(T+1)$.
  
Applying the property  $\uqw^d_r(N^d_r,s^d_r)$ to the set $A$, radius $r$, and target size $m=T+1$
		 yields a set $S\subset V(G)$ with $|S|\le s$
	and a set $B\subset A$ with $|B|\geq T+1$ 
  of tuples which are  mutually $r$-independent  in $G-S$.
  Let $J\subset {1,\ldots,k}$
  be the set of indices corresponding to $B$,
  i.e., $J=\setof{j}{\bar u_j\bar v_j\in B}$.
  
  

  
  
		Let
    $N$
    be the set of vertices occurring in   the  tuples $\bar v_j$ with $j\in J$. Note that each tuple $\bar u_j$, for $j\in J$, is $r$-separated by $S$ from $M$.    
    % Then $M$ and $N$ are $r$-separated by $S$.
    Since $|J|=|B|\geq T+1$, by~\cref{cor:bound}, there are 
    $i,j\in J$ with $i<j$ and $\tp^\phi(\bar u_i/N)=
    \tp^\phi(\bar u_j/N)$.
    In particular, $\phi(\bar u_i,\bar v_i)$ holds in $G$
    if and only if $\phi(\bar u_j,\bar v_i)$ holds in $G$.
    This is the contradiction, since the former  holds as $i\le i$, and the latter does not hold as $\neg (j\le i)$.
This finishes the proof of \cref{thm:new-stable}.
\end{proof}





\begin{comment}
\begin{proof}[of \cref{thm:new-stable}]\todo{Fix}We 
  define the function~$g(\cdot)$ from the statement of the theorem as follows. Fix $q\in \N$.  
  Let $p,r$ be the numbers described in~\cref{lem:types}. Define $g(q)\coloneqq 10\cdot r$.
	Let $\phi$ be the given formula of quantifier rank $q$ and with $d$  free variables, partitioned into $\bar y$ and $\bar z$.
 From now on we consider only graphs $G$ such that $K_t\not\minor_{10r} G$.
By~\cref{rem:local-tuples},
this implies the statement $\textrm{UQW}(d,r)$.


	% In the proof of \cref{thm:uqw-stable} we have introduced the following parameters:
%   \begin{eqnarray*}
%   s=s^d(2r), \qquad T_i\le (s+d_i)^{d_i}\cdot |\mathrm{Tp}_{d_i}^{q,s}|\ \textrm{ for $i=1,2$},\qquad\textrm{and}\qquad m=T_1T_2+1.
%   \end{eqnarray*}
%   As we argued, $s$ is bounded by a computable function of $t$, $d$, and $q$.
%   It is well known that given $d_1,d_2,q,s$, one can compute the number of quantifier rank $q$ types $|\mathrm{Tp}_{d_1}^{q,s}|$ and $|\mathrm{Tp}_{d_2}^{q,s}|$; see e.g.~\cite{libkin}.
%   Thus, $m$ is also bounded by a computable function of $t$, $d$, and $q$.
	
Finally, in the proof of \cref{thm:uqw-stable} we have argued that the ladder index of $\phi$ is bounded by $N^d(2r,m)$, where $d=|X|$, $m=T(s^d(2r),q,d)+1$
and $T(\cdot,\cdot,\cdot)$ is a computable function,
and the only reference to the quasi-wideness of $\CCC$ in the proof
is by invoking \cref{prop:uqw-tuples}.
As we argued above, in \cref{prop:uqw-tuples} it suffices to assume $K_t\not\minor_{10r} G$ to claim that $N^d(2r,m)$ is bounded by a computable function of $m$, $t$, $d$, and~$q$.
Since $m$ is bounded by a computable function of $t$, $d$, and $q$, the obtained upper bound on the ladder index of $\varphi$ depends in a computable way on $t$, $d$, and~$q$,
and to derive it we only need to assume that $K_t\not\minor_{10r} G$. This concludes the proof.
\end{proof}


$N(\cdot,\cdot)$ be the function given by \cref{thm:new-uqw}.
	Following the proof of \cref{prop:uqw-tuples}, we see that for the functions $N^d(r,m)$ and $s^d(r)$, we can take the following functions:%
		\newcommand{\pow}{\ \uparrow\ }%
	\begin{align*}
	 N^d(r,m)&= c\cdot (m d)\pow(2(t+4))\pow(d(t+2r)),\\
	  s^d(r)&= d\cdot t,
	\end{align*}
where $x\pow y$ denotes $x^y$ and associates to the right, i.e., $x\pow y\pow z=x^(y^z)$.
In particular, the proof of \cref{prop:uqw-tuples} shows the following property
($\ast$)
for every graph $G$ such that $K_t\not\minor_{3r+1} G$ 
and for every set of $d$-tuples $A\subset V(G)^d$ of size at least $N^d(r,m)$
there is a subset $B\subset A$ of size $m$ and $S\subset V(G)$ of size at most $s^d(r)$
such that $B$ is mutually $r$-independent in $G-S$.

	
As in the proof of \cref{thm:uqw-stable}, let $r=7^q$,  
$s=s^d(2r)=d\cdot t$,  $T=(s+d)^d\cdot |\mathrm{Tp}_d^{q,s}|$ and $m=T+1$.



Let $\cal C$ be the class of all graphs $G$
such that $K_t\not\minor_{3r+1} G$, i.e., $K_t\not\minor_{3\cdot 7^q+1} G$. We repeat the argument presented in the second paragraph of the proof of \cref{thm:uqw-stable}, and assume that there is a $\phi$-ladder in $G\in \cal C$ of length larger than $N^d(2r,m)$.
 Instead of applying \cref{prop:uqw-tuples} we apply  ($\ast$) above
and obtain sets  $S$ and $B$ with the required properties. As before, this yields a contradiction. 


In particular, every $\phi$-ladder in a graph $G\in \cal C$ has length at most $N^d(2r,m)$, 
which is at most $$c'\cdot (d^{d+1}\cdot (t+1)^d\cdot |\mathrm{Tp}_d^{q,d\cdot t}|)\pow(2t+8)\pow(d\cdot t+2d\cdot 7^q),$$
where $c'$ is some constant.
As the number $|\mathrm{Tp}_d^{q,s}|$ is computable given $d,q,s$, this 
 yields \cref{thm:new-stable}.
\end{proof}
\end{comment}
