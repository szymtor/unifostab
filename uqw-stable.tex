
\section{From uniform quasi-wideness to stability}\label{sec:stable}
The main result of this section is Theorem~\ref{thm:uqw-stable},
which states 
that a class of graphs which is uniformly quasi-wide is stable.
In Section~\ref{sec:uqw-tuples} we formulate a consequence of the uniform quasi-wideness which
holds for tuples of vertices. In Section~\ref{sec:uqw-stable} we prove Theorem~\ref{thm:uqw-stable}
using Gaifman's Locality Theorem.


\subsection{Uniform quasi-widness for tuples}\label{sec:uqw-tuples}
Fix a graph $G$, a number $d\in\N$ (the dimension) and a number $r\in \N$ (the radius).
If $S\subset V(G)$ is a set of vertices and $A\subset V(G)^d$ is a set of $d$-tuples of vertices,
then we say that $A$ is $r$-\emph{totally independent} in $G-S$ 
if the set of all vertices $v\in G-S$ which appear on some coordinate of some tuple $\bar a\in A$
is $r$-independent in $G-S$. 


\begin{proposition}\label{prop:uqw-tuples}
	Let $\cal C$ be a uniformly quasi-wide class of graphs and $d\in\N$ a number.
	There is a  function $N^d:\N\times\N\to\N$ and a function $s^d:\N\to\N$
	such that for all $r,m\in\N$ and all subsets $A\subset V(G)^d$
	with $|A|\ge N^d(r,m)$ there  is a set $S\subset V(G)$
	of size $|S|\le s^d(r)$ and a subset $B\subset A$ of size $|B|\ge m$ which is totally $r$-independent in $G-S$.
\end{proposition}
\begin{proof}We fix a uniformly quasi-wide class $\cal C$ and functions $N:\N\times\N\to \N$
	and $s:\N\to\N$ as in the definition of uniform quasi-wideness.
	Let $d\in \N$ be a fixed dimension.
		For a fixed graph $G\in \cal C$  and
	  coordinate $i\in\set{1,\ldots,d}$, let $\pi_i$ denote the projection from $V(G)^d$ onto the $i$th coordinate.

	


\begin{lemma}\label{lem:step1} For any $r,m\in \N$ there is a number $K(r,m)$ such that
	for any given $A\subset V(G)^d$ with $|A|\ge K(r,m)$,
	there is a set $B\subset A$ with $|B|\ge m$ and a set $S\subset V(G)$ with $|S|\le d\cdot s(r)$, 
	such that for each coordinate $i=1..d$, 
 $\pi_i(B)$ is $r$-independent in $G-S$. 
\end{lemma}
\begin{proof}

Let $f$ be the function defined so that $f(m)=N(r,m)\cdot m$ for $m\in\N$.

\begin{claim}\label{claim:ith-coord}
Fix a coordinate $i\in\set{1,\ldots,d}$, a number $m'\in\N$ and a  set $A\subset V(G)^d$ with  $|A|\ge f_r(m')$.
There is a set $B\subset A$ such that $|B|\ge m'$
and $S\subset V(G)$ such that $|S|\le  s(r)$,
so that  $\pi_i(B)$ is $r$-independent in $G-S$.	
\end{claim}
To prove the claim, 
we consider two cases.
If $\pi_i(A)\subset V(G)$ has at least $N(r,m')$ elements, then we apply the definition of uniform quasi-wideness to $\pi_i(A)\subset V(G)$. Let $S\subset V(G)$ and $B'\subset \pi_i(A)$
be as in the definition, i.e., $B'$ is $r$-independent in $G-S$,
$|B'|\ge m'$ and $|S|\le s(r)$. Let $B\subset A$ be the set of all tuples 
whose $i$th coordinate belongs to the set $B'$, i.e., $B=\pi_i^{-1}(B')\cap A$.
Clearly, $|B|\ge |B'|\ge m'$, and $|S|\le s(r)$.

If $\pi_i(A)$ has less than $N(r,m')$ elements, then choose the element $a\in\pi_i(A)$ whose inverse image $\pi_i^{-1}(\set a)\cap A$ has the largest cardinality. Let $S=\set{a}$ 
and let $B=\pi_i^{-1}(\set a)$. Then $|B|\ge \frac{|A|}{|\pi_i(A)|}\ge \frac{|A|}{N(r,m')}\ge \frac {f(m')}{N(r,m')}=m'$,
and $|S|=1$. This proves Claim~\ref{claim:ith-coord}.


We now prove Lemma~\ref{lem:step1}.
Let $A\subset V(G)^d$ be such that $|A|\ge f^d(m)$. 
Define $B_0=A$, $S_0=\emptyset$, and for $i=1..d$,
let $B_{i}$ and $S_i$ be the $B$ and $S$ obtained from  Claim~\ref{claim:ith-coord} applied to the se of tuples $B_{i-1}\subset V(G)^d$, the coordinate $i$, and $m'=f^{d-i}(m)$.  The invariant is that $|B_i|\ge f^{d-i}(m)$.
In particular, 
taking $B=B_d$ and $S=S_1\cup\ldots \cup S_d$, we obtain that $|B|\ge m$ and $|S|\le d\cdot s(r)$, and, by construction, $\pi_i(B)$
is $r$-independent in $G-S$, for every coordinate $i\in\set{1,\ldots,d}$. Letting $K(r,m)=f^d(m)$ yields the lemma.
\end{proof}


\begin{lemma}\label{lem:step2}
	Let $B\subset V(G)^d$ and $S\subset V(G)$ be such that for  $i=1..d$,
	$\pi_i(B)$ is $2r$-independent in $G-S$.
	Then there is a set $C$ with $C\subset B$ 
	such that $C$ is totally $r$-independent in $G-S$
	and $|C|> \frac{|B|}{d^2}$.
\end{lemma}
\begin{proof}
We construct a sequence of sets $C_0\subset C_1\subset \ldots$ of subsets of $B$ which are totally $2r$-independent in $G-S$, as follows.

We start with $C_0=\emptyset$. Suppose that $C_s\subset B$ is 
 already constructed for some $s\ge 0$
 and is totally $2r$-independent in $G-S$; we construct $C_{s+1}$.  To each element $a\in B-C_s$,
we associate any function $f_a:\set{1,\ldots,d}^2\to C_s\cup \set{\bot}$,
with the following properties:
\begin{itemize}
	\item If $f_a(i,j)=b$ then the $i$th coordinate of $a$
	and the $j$th coordinate of $b$ are at distance at most $r$
	in $G-S$;
	\item If $f_a(i,j)=\bot$ then there is no element $b\in C_s$ 
	such that the $i$th coordinate of $a$ and the $j$th coordinate of $b$ are at distance at most $r$ in $G-S$.	
\end{itemize}
Observe that whenever $a_1, a_2$ are two distinct elements of $B-C_s$,
then for all $i,j\in \set{1,\ldots,d}^2$, the values $f_{a_1}(i,j)$ and $f_{a_2}(i,j)$
cannot be equal to the same element $b\in C_s$:
otherwise, we would have that the $i$th coordinate of $a_1$
and the $i$th coordinate of $a_2$ are at distance at most $2r$
in $G-S$, which is impossible by the assumption on $B$.

In particular, if $|B-C_s|> |C_s|\cdot d^2$
then there must be some element  $a\in B-C_s$  
such that $f_a(i,j)=\bot$  for all $i,j\in\set{1,\ldots,d}$.
Let $C_{s+1}=C_s\cup \set s$.
By construction, $C_{s+1}$ is totally $2r$-independent in $G-S$.

We may repeat the construction as long as $|B|>|C_s|\cdot (d^2-1)=s\cdot (d^2-1)$, and we stop when this inequality no longer holds. Define the set $C$ as the last constructed set $C_s$.
By construction, $|C_s|=s\ge 
\frac{|B|}{d^2-1}>\frac{|B|}{d^2}$.	
\end{proof}

To finish the proof of Proposition~\ref{prop:uqw-tuples},
given a set $A\subset V(G)^d$ and numbers $r,m\in\N$,
first apply Lemma~\ref{lem:step1} 
  with $r'=2r$ and
 $m'= m\cdot d^2$.
 Assuming that $|A|\ge K(r',m')$, 
we obtain a set $B\subset A$ with $|B|\ge m\cdot d^2$ and a set $S\subset V(G)$ with $|S|\le s(2r)$.
To $B$ and $S$, apply Lemma~\ref{lem:step2}, yielding a set $C\subset B$ which is totally $r$-independent in $G-S$ and has size at least $m$. This yields the proposition, for $N^d(r,m)=K(r',m')=K(2r,m\cdot d^2)$
and $s^d(r)=d\cdot s(2r)$.
\end{proof}


\subsection{Excluding long ladders}
\label{sec:uqw-stable}
By a \emph{colored graph} we mean a graph  in which 
every vertex is assigned zero or more colors from a fixed set of colors. We view a colored graph as a relational structure as usual, by viewing each color as a unary predicate. 

The \emph{quantifier rank} of a formula $\phi$ is the maximal number of nested quantifiers. Fix a set of colors $C$.
Let $(G_1,\bar v_1)$ and $(G_2,\bar v_2)$ be two
colored graphs with distinguished tuples of vertices of the same length $d$. We say that $(G_1,v_1)$ and $(G_2,v_2)$
have the same \emph{quantifier rank $q$ type}
if for every formula $\phi(\bar x)$ with $d$ free variables and of quantifier rank $q$,
 $$G_1,\bar v_1\models \phi(\bar x)\qquad\iff \qquad G_2,\bar v_2\models \phi(\bar x).$$
 The equivalence class of $(G,\bar v)$ under the above equivalence relation is called the \emph{quantifier rank $q$ type} of $(G,\bar v)$, and  the set of \emph{quantifier rank $q$ types with $d$ free variables}
is the set of all equivalence classes.

The following lemma is standard~(see e.g.~\cite{libkin}).
\begin{lemma}\label{lem:q-types}
	Fix a set of colors $C$, a rank $q$ and a number of variables $d$.
	Then the set of quantifier rank $q$ types with $d$ free variables is finite.
\end{lemma}


The following theorem is the main result of Section~\ref{sec:uqw-stable}.


\begin{theorem}\label{thm:uqw-stable}
	Let $\cal C$ be a uniformly quasi-wide class of graphs.
	Then $\cal C$ is stable. More precisely, if $\phi(\bar u,\bar v)$ is a formula with $d$ free variables and quantifier rank $q$, and $N^d(r,m)$ and $s^d(r)$ are as in Proposition~\ref{prop:uqw-tuples}, then for all graphs $G\in\cal C$,  the ladder index of $\phi$ is at most $N^d(2r,(2T)^d)$,
where $r= 7^q$,
 $T$ is the number of all quantifier rank $q$ types with one free  variable over the signature of  graphs colored with $s^d(2r)$ colors.
\end{theorem}
Before giving a proof of Theorem~\ref{thm:uqw-stable},
we state a consequence of Gaifman's Locality Theorem.
 If $G$ is a colored graph, $r\in\N$  a number and $\bar a$ a tuple of vertices $a_1,\ldots,a_d$  of vertices of $G$, then  $N^G_r[\bar a]$ denotes the pair $(H,\bar a)$, where $H$ is the colored subgraph of $G$
induced by the set of all vertices which are in distance at most $r$
from some vertex in $\bar a$.
% We say that a formula $\phi(\bar x)$ with $d=|\bar x|$ free variables is \emph{$r$-local} if for every colored graph $G$ and every $\bar a_1,\bar a_2\in V(G^d)$, if  $N^G_r(\bar a_1)$ and  $N^G_r(\bar a_2)$
% are isomorphic, then $G,\bar a_1\models \phi(\bar x)$ if and only if $G,\bar a_2\models \phi(\bar x)$.

\begin{lemma}\label{lem:gaifman}
	Let $\phi(\bar x)$ be a  formula 
	of quantifier rank $q$
	in the signature of colored graphs. 	Then, whether a tuple $\bar a$ of vertices of $V(G)$
	satisfies the formula $\phi(\bar x)$
	depends only on the quantifier rank $q$ type of  $N^G_r[\bar a]$,
 where $r=7^q$.
\end{lemma}
\begin{proof}This is an immediate consequence of the Main Theorem~in~\cite{gaifman1982local}.
\end{proof}

\medskip
The rest of Section~\ref{sec:uqw-stable} is devoted to a proof of Theorem~\ref{thm:uqw-stable}.
To prove Theorem~\ref{thm:uqw-stable}, we will use Proposition~\ref{prop:uqw-tuples} and work with graphs $G$
with a set of vertices $S$ removed.
We will use the following notation allowing to translate a first order formula $\phi$ talking about a graph $G$ into an equivalent formula talking about a suitably colored  graph $G$ with the set of vertices $S$ removed.

Let $G$ be a graph and $S\subset V(G)$
be a set of its vertices.
Define the structure $G^{S}$
as the colored graph $G-S$, where for each $s\in S$, all vertices $v$
which are neighbors of $s$ in $G$ are colored with color $C_s$.

Fix a formula $\phi(\bar x)$.
Let $\bar y$ be a non-repeating tuple of variables and $\alpha$ a tuple whose elements belong to $\bar y$ or $S$, of the same length as $\bar x$.
Denote by $\phi^{\bar \alpha}(\bar y)$ the formula with free variables $\bar y$ obtained from $\phi$ by substituting for the variable $x_i$ the element $\alpha_i$, which is either a variable in $\bar y$  or an element of $S$. 


\begin{lemma}\label{lem:remove-s}Let $G,S$ be as above.	
For every formula $\phi(\tup{x})$ and tuples $\bar y,\bar\alpha$ as above,
there is a formula $\phi'(\bar y)$ 
of the same quantifier rank as $\phi$ over the signature of $G^S$ 
 such that for every tuple $\tup{a}$ of vertices of $G-S$
 of the same length as $\bar y$,
the following equivalence holds:
$$G\models\phi^{\bar\alpha}(\tup{a})\qquad\Leftrightarrow\qquad G^S\models\phi'(\tup{a}).$$
\end{lemma}
\begin{proof}
The proof proceeds by induction on the structure of the formula $\phi$. If $\phi$ is an atomic formula,
then $\phi^{\bar \alpha}(\bar y)$ is also an atomic formula, and, depending on its form, 
we consider the appropriate case below. Below, $x$ ranges over variables in $\bar y$
and $s,t$ range over elements of $S$.
\begin{enumerate}
	\item If $\phi^{\bar \alpha}(\bar y)$ is $E(x,s)$, 
then let $\phi'$ be the formula $C_s(x)$.
\item If $\phi^{\bar \alpha}(\bar y)$ is $x=s$, then let $\phi'$
be the formula $\bot$. 
	\item If $\phi^{\bar \alpha}(\bar y)$ is $E(s,t)$, 
then let $\phi'$ be the formula $\top$ if $s$ and $t$ are adjacent in $G$, and $\bot$ otherwise. 
	\item If $\phi^{\bar \alpha}(\bar y)$ is $s=t$, 
then let $\phi'$ be the formula $\top$ if $s=t$ and $\bot$ otherwise. 
\end{enumerate}

For the inductive step, we consider two cases.
If $\phi$ is a boolean combination of formulas $\phi_1,\ldots,\phi_k$, then 
apply the inductive assumption to each formula $\phi_i$,
yielding formulas $\phi_1',\ldots,\phi_k'$. Then let $\phi'$ be the analogous boolean combination of the formulas $\phi_1',\ldots,\phi_k'$.

Finally, suppose that $\phi$ is of the form $\exists x.\psi(\bar y x)$, where $x$ is not free in $\phi$ (the case of $\forall$ is dual). If $v$ is either the variable $x$ 
or an element $s\in S$, 
let $\psi^v(\bar y)$ be the formula obtained from the inductive assumption applied to the formula $\psi(\bar y x)$ 
and tuple $\bar \alpha$ with the element $v$ appended to it.
Then let $\phi'(\bar y)$
be the formula $\exists x.\psi^x(\bar yx)\lor \bigvee_{v\in S}\psi^v(\bar y)$.

In each case, it follows from the inductive assumption that $\phi'$ 
satisfies the required condition.
\end{proof}



\begin{proof}[ of Theorem~\ref{thm:uqw-stable}]
Let $r=  7^q$, 
let $\phi$ be a formula of quantifier rank $q$ and $d$ free variables,
and let $T'$ denote the number of all quantifier rank $q$ types of 
formulas with one free variable over the signature of  graphs colored by $s^d(r)$ colors.
Finally, let $m=(T'+s^d(2r))^d+1$. 

We show that 
every $\phi$-ladder in a graph $G\in\cal C$ has length smaller than $N^d(2r,m)$, which is at most $N^d(2r,(2T)^d)$ as $m\le (T'+s^d(2r)+1)^d\le (2T)^d$.
To reach a contradiction, assume that there is a graph $G\in\cal C$, a number $k\ge N^d(2r,m)$
and tuples $\bar u_1,\ldots,\bar u_k\in V(G)^{\bar u}$ and $\bar v_1,\ldots,\bar v_k\in V(G)^{\bar v}$
which form a $\phi$-ladder in $G$.
	Let $A=\set{\bar u_i\bar v_i: i=1,\ldots,k}\subset V(G)^d$; note that $|A|=k$.
Applying Proposition~\ref{prop:uqw-tuples} to the set $A$, the radius $2r$, and target size $m$
		 yields a set $S\subset V(G)$ such that $|S|\le s^d(2r)$
	and a set $B\subset A$ of size $m$ which is totally $2r$-independent in $G-S$.

Replacing $A$ by $B$, we may assume that $\bar u_1,\ldots,\bar u_m\in V(G)^{\bar u}$ and $\bar v_1,\ldots,\bar v_k\in V(G)^{\bar v}$
form a $\phi$-ladder of length $m$ in $G$, and 
that $A$ is totally $2r$-independent in $G-S$.

To each  vertex $v$ of $G$ 
assign a color which is equal to $v$ if $v\in S$,
and otherwise, the color of $v$ is the quantifier rank $q$ type of  $N^r_{G^S}[v]$. Note that this coloring uses $T'+s^d(2r)$ colors.
If $\bar v$ is a tuple of vertices of $G$, then its \emph{color tuple} is the tuple of colors assigned to the components of $\bar v$.



\begin{claim}
	For each $1\le i,j\le m$, whether $\phi(\bar u_i,\bar v_j)$
	holds in $G$ depends only on the color tuple  of~$\bar u_i\bar v_j$.
\end{claim}
\begin{proof}
	Suppose that $\bar w_1$ and $\bar w_2$ are two  $\bar x$-tuples of 
	vertices of $V(G)$ such that $\set{\bar w_1}$ and $\set{\bar w_2}$ are both totally $2r$-independent in $G-S$, and  $\bar w_1$ and $\bar w_2$ have the same color tuples. We show that $$G,\bar w_1\models \phi(\bar x)\iff G,\bar w_2\models \phi(\bar x).$$ The claim will then follow by taking $\bar w_1$ and $\bar w_2$ to be of the form $\bar u_i\bar v_j$.
	
	
	
	Define a tuple $\bar \alpha$ as follows. For $j=1..|x|$, if the $j$th element in the tuple $\bar w_1$ is an element $s$ belonging to $S$, then the $j$th element of $\bar \alpha$ is $s$;
	otherwise, the $j$th element of $\bar \alpha$ is the $j$th variable in the tuple $\bar x$. Note that using $\bar w_2$ in place of $\bar w_1$ in the above definition would yield the same tuple $\bar \alpha$. 	For $i=1,2$, let $\bar w_i^S$ denote the tuple obtained from $\bar w_i$ by removing those elements which belong to $S$.
	
	Let $\bar y$ be the sequence of variables occurring in $\bar \alpha$.
	Consider the formulas $\phi^{\bar \alpha}(\bar y)$ and $\phi'(\bar y)$ as described in Lemma~\ref{lem:remove-s}.
	In particular, the following equivalences hold:
	\begin{align}\label{eq:iff}
	G\models\phi(\bar w_i)\iff G\models\phi^{\bar\alpha}(\bar w_i^S)\iff G^S\models\phi'(\bar w_i^S).		
	\end{align}
		Note that $\phi'$ has the same quantifier rank as $\phi^{\bar \alpha}$, which, in turn, is the same as the quantifier rank of $\phi$, i.e., $q$. Hence, by Lemma~\ref{lem:gaifman}, whether $\phi'(\bar w_i^S)$ holds in $G^S$ depends only on the quantifier rank $q$ type of $N^r_{G^S}[\bar w_i^S]$. 
Since the  elements of the tuple $\bar w_i^S$ are $2r$-independent in $G-S$, the $r$-neighborhood of $\bar w_i^S$ in $G^S$  
is (isomorphic to) a disjoint union of the $r$-neighborhoods in $G^S$
of $v$, for $v$ ranging over the elements of the tuple $\bar w_i^S$.


		\begin{lemma}\label{lem:type-union}
			For $i=1,2$, let $G_i,H_i$ be colored graphs,
			and $a_i$ be a tuple of vertices of $G_i$
			and $b_i$ be a tuple of vertices of $H_i$.
			Suppose that $(G_1,\bar a_1)$ and $(G_2,\bar a_2)$ 
			have the same quantifier rank $q$ type,
			and $(H_1,\bar b_1)$ and $(H_2,\bar b_2)$ 
			have the same quantifier rank $q$ type.			
			Then the quantifier rank $q$ type of the disjoint union 
			$(G_1\oplus H_1,\bar a_1\bar b_1)$ is equal to the one of $(G_2\oplus H_2,\bar a_2\bar b_2)$. \end{lemma}
\begin{proof}[Sketch]
	The proof proceeds by applying the well-known characterization 
	of quantifier rank $q$  types using Ehrenfeucht-Fraisse games (see e.g.~\cite{libkin}). By assumption, duplicator has a winning strategy $\gamma$ in the $q$-round game on $(G_1,\bar a_1)$ and $(G_2,\bar a_2)$, and a winning strategy $\eta$ in the $q$-round game on $(H_1,\bar b_1)$ and $(H_2,\bar b_2)$. The strategies $\gamma$ and $\eta$ can be combined into a winning strategy on $(G_1\oplus H_1,\bar a_1\bar b_1)$ and $(G_2\oplus H_2,\bar a_2\bar b_2)$.
\end{proof}

By assumption that the tuple colors of $\bar w_1$ and of $\bar w_2$ are equal it follows that for $j=1..|\bar x|$,
if $w^j_1$ is the $j$th coordinate of the tuple $\bar w_1$
and $w^j_2$ is the $j$th coordinate of the tuple $\bar w_2$,
then the quantifier rank $q$ types of $N^r_{G^S}[w^j_1]$ and 
of $N^r_{G^S}[w^j_2]$ are equal, assuming $w^j_1$ and $w^j_2$
are not in $S$. Lemma~\ref{lem:type-union} then implies 
that the quantifier rank $q$ types of  $N^r_{G^S}[\bar w_1^S]$ and of $N^r_{G^S}[\bar w_2^S]$ are equal. 
In particular, whether $\phi'(\bar w_i^S)$ holds in $G^S$ is independent of $i=1,2$
It follows from~\eqref{eq:iff} that whether $\phi(\bar w_i)$ holds
in $G$ is independent of $i=1,2$, proving the claim.
\end{proof}


%
%
% An \emph{$r$-local formula} $\phi(\bar x)$ is a
% formula such that for every colored graph $G$ and tuple of vertices $\bar a\in V(G)^{\bar x}$, the following equivalence holds:
% $$G,\bar a\models \phi\qquad\textit {if and only if }\qquad G[N^{r}(\bar a)],\bar a\models \phi.$$
%
% \begin{theorem}\label{thm:gaifman}
% 	Let $\phi(\bar x)$ be a formula over the signature of colored graphs of quantifier rank $q$.
% 	There is a  number $r\le 7^{q}$
% 	% , and $s\le q+|\bar x|$,
% 	such that $\phi$ is equivalent to a Boolean combination of sentences and $r$-local formulas $\psi^{(r)}(\bar x)$.% the following:
% % 	\begin{itemize}
% % 		\item $r$-local formulas ;
% % 		\item sentences.%  of the form $$\exists y_1,\ldots,y_s
% % % \bigwedge_{1\le i\le s} \alpha^{(r)}(y_i)\land
% % % \bigwedge_{1\le i<j\le s} d^{>2r}(y_i,y_j),$$
% % % where $\alpha^{(r)}(y)$ is $r$-local and in one variable,
% % %  and $d^{>2r}(v,w)$ expresses the property that $\set{v,w}$ is $2r$-independent.
% % 	\end{itemize}
% \end{theorem}

Since the set $A$ has $m=(T+s^d(r))^d+1$ elements,
and each tuple $\bar u_i\bar v_i\in A$ has an associated color tuple 
belonging to a set of cardinality $(T+s^d(r))^d$, 
by the pigeonhole principle, there are $i$ and $j$ 
such that $1\le i<j\le m$ and  $\bar u_i\bar v_i$ and $\bar u_j\bar v_j$ have the same color tuples.
By the claim above,  $\phi(\bar u_i,\bar v_j)$ holds in $G$
 if and only if $\phi(\bar u_j,\bar v_i)$ holds in $G$, which is a contradiction with the assumption that $\bar u_1,\ldots,\bar u_m$ and $\bar v_1,\ldots,\bar v_m$ form a $\phi$-ladder.
 This finishes the proof of Theorem~\ref{thm:uqw-stable}.
\end{proof}


