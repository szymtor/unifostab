\section{Uniform quasi-wideness}\label{sec:uqw}

This section is devoted to the proof of~\cref{thm:new-uqw}. 
Even though we prove a purely graph theoretic statement, 
it is useful to see our methods in a more general model-theoretic context. 


%\begin{definition}
%If $\tau$ is a word over an alphabet $\Sigma$ and
%$a\in \Sigma$, then $\tau\cdot a$ denotes the concatenation of~$\tau$
%and $a$.  The \emph{branching index} of a formula $\psi(\tup{x},\tup{y}$
%over a graph $G$ is the largest number
%$\ell$ such that there are tuples of elements
%$\tup{u}_{\sigma_1},\ldots, \tup{u}_{\sigma_{2^\ell}}\in V(G)$, indexed by the
%words over the alphabet $\{0,1\}$ of length exactly $\ell$, and
%tuples of elements $\tup{v}_{\tau_1},\ldots, \tup{v}_{\tau_{2^\ell-1}}$, indexed by the
%words over $\{0,1\}$ of length strictly smaller than $\ell$, such that
%if $\tau_j\cdot a$ is a (not necessarily proper) prefix of~$\sigma_i$, then
%$G\models \psi(\tup{u}_{\sigma_i},\tup{v}_{\tau_j})$ if, and only if, $a=1$. The tuples
%$\tup{u}_{\sigma_1},\ldots, \tup{u}_{\sigma_{2^\ell}}\in V(G)$ are called the 
%\emph{leaves} of the tree, the tuples $\tup{v}_{\tau_1},\ldots, \tup{v}_{\tau_{2^\ell-1}}$
%are its \emph{inner nodes}. Intuitively, a leaf $\tup{u}$ is connected to its 
%predecessors~$\tup{v}$ such
%that $\tup{u}$ is a \emph{right successor} of $\tup{v}$ and not to its predecessors such that 
%it is a \emph{left
%successor}. 
%\end{definition}
     

%\begin{lemma}[\cite{hodges1993model}, Lemma 6.7.9, p.\
%  313]\label{lem:branching}
%  Let $\psi(\tup{x},\tup{y})$ be a formula and let $G$ be a graph. 
%  If $\psi$ has branching index~$k$ over $G$, 
%  then~$\psi$ has ladder index smaller than $2^{k+1}$ over $G$. 
%  If $\psi$ has  has
%  ladder index $k$ over $G$, then $\psi$ has branching index smaller than
%  $2^{k+2}-2$ over $G$.
% \end{lemma}

In the proof of~\cref{thm:malshelah} one constructs a tree, in which
elements are iteratively classified according to their types. The depth of 
the type tree is directly related to the ladder index of the formula, 
more precisely to the \emph{branching index} of the formula. We refrain
from defining the branching index here and refer to~\cite{malliaris2014regularity}
and to Lemma 6.7.9 of the textbook \cite{hodges1993model}, which relates
ladder index and branching index. In this section we will be working with 
formula $\phi(x,y)$ with exactly two free variables only. 

Let $T$ be a binary tree, where each vertex (except the root) is 
marked as a left or right successor of its predecessor. We call $w$ 
a \emph{left (right) descendant} of $v$ if the first successor on the unique
$v$-$w$ path in $T$ is a left (right) successor. A root-leaf path in $T$ is called
$k$-alternating if it contains $k+1$ nodes $a_1,\ldots, a_{k+1}$ (which appear
in that order on the path, possibly not consecutively) such that $a_{i+1}$ is a left successor of $a_i$
if and only if $a_{i+2}$ is a right successor of $a_{i+1}$, $1\leq i\leq k-2$. 
The \emph{alternation rank} of $T$ is the largest number $t$ such that 
$T$ contains a $t$-alternating path of length $t$.

\begin{lemma}
Let $T$ be a tree of alternation rank $t$. If
$T$ has height at most~$h$, then $T$ has at most $(2h+2)^{t+1}$
vertices. 
\end{lemma}
\begin{proof}
Denote by $n_\ell^s$ the number of vertices a binary tree without a 
an $s$-alternating path can have. Then we have $n_0^s\leq 1$ for all $s\geq 1$
and $n_\ell^1\leq 2\ell-1$ for all $\ell$, and 
\begin{align*}
n_\ell^s\leq 2(n_{\ell-2}^{s-1}+n_{\ell-3}^{s-1}+\ldots + n_{0}^{s-1})+2\ell-1
\end{align*}
for all $s\geq 2,\ell\geq 1$. In the last inequality, we count the two paths of length
$\ell$ staring in the root which have no alternations. All nodes branching from 
these paths have one less alternation available. 
Now it is easy to check that the function $(2\ell+2)^s$ satisfies these requirements. 
\end{proof}

Let $\phi(x,y)$ be a formula with $2$ free variables and let $(v_1,\ldots, v_n)$
be a sequence of vertices of $G$. The \emph{type tree}
of $\phi$ over $(v_1,\ldots,v_n)$ is a binary tree which is constructed recursively as 
follows. We make $v_1$ the root of the tree. Assume that $v_1,\ldots, v_i$
have been inserted to the tree. We follow a root-leaf path to find the
position for the next vertex $v_{i+1}$. If $G\models\phi(v_j,v_{i+1})$, we
follow the right branch at $v_j$, otherwise we follow the left branch. If there is
no such successor, we insert $v_{i+1}$ as a right or left child of $v_j$, 
accordingly. 

\begin{lemma}
Let $\phi(x,y)$ be a formula with $2$ free variables and let
$(v_1,\ldots, v_n)$ be a sequence of elements of $G$. Then the 
alternation rank of the type tree of $\phi$ over $(v_1,\ldots, v_n)$
is at most twice the ladder index of $\psi$. 
\end{lemma}
\begin{proof}
An alternating path in $T$ is a $\phi$-ladder.
\end{proof}

We are now ready to prove~\cref{thm:new-uqw}. As in the 
original proof of Ne\v{s}et\v{r}il and Ossona de Mendez, the main 
idea is to find a few elements to delete such that a large
subset $A'\subseteq A$ is $2$-independent. We can then 
contract the disjoint neighborhoods of these elements and
continue with the depth-$1$ minor $G'$, where we 
identify $A'$ in $G$ with a set of vertices in $G'$. A $2$-independent
subset of $A'$ in $G'$ will be a $4$-independent set in $G$, 
and so on, until we finally arrive at an $r$-independent set. 

We can use Ramsey's Theorem to first find an independent subset
of $A$. 

\begin{lemma}
Let $G$ be a graph such that $K_t\not\subseteq G$. If $A$
has size at least $\binom{m+t-2}{t-1}$, then there exists
a subset $B\subseteq A$ of size at least $m$ which is an
independent set. 
\end{lemma}

We now consider the formula 
$\phi_2(x,y)\coloneqq \dist_G(x,y)\leq 2$, for which we can give an explicit 
bound on the alternation rank in its type tree. 

\begin{theorem}
Let $G$ be a graph such that $K_t\not\minor_2G$ and let
$(v_1,\ldots, v_n)$ be an enumeration of an independent set 
in $G$. Then the alternation rank of the type tree of $\phi$ 
over $(v_1,\ldots, v_n)$ is at most $2t-1$. 
\end{theorem}
\begin{proof}
According to \cref{lem:minor-to-tree} we may assume that we find
the largest complete binary tree as a subgraph. We consider the
vertices $a_1,b_1,\ldots, a_k,b_k$ of the alternating path in the
type tree. Because $(v_1,\ldots, v_n)$ is independent in $G$, 
none of these vertices is adjacent and all of the vertices on the
paths of length $2$ which cause the creation of edges in the type
tree are distinct from $a_1,\ldots, b_k$. 

\begin{claim}
Every vertex $a_i$ is connected to every $b_j$, $j\geq i$,
via a vertex $z_{ij}$ which is not connected to any~$b_\ell$, $\ell\neq j$. 
\end{claim}

\noindent\textit{Proof.} Because $b_j$, $j\geq i$, is right of $a_i$, there is 
an element $z_{ij}$ connected to $a_i$ and $b_j$. If $z_{ij}$ was 
connected to $b_\ell$, $\ell\neq j$, then $b_\ell$ would be adjacent 
to $b_j$ in the type tree, which it is not. \hfill$\lrcorner$

\bigskip
We now contract $b_j$ and all $z_{ij}$ as well as $a_j$ to a single 
vertex for all $1\leq j\leq k$, $1\leq i\leq j$. We obtain a complete
graph $K_k$ as a depth-$2$ minor. 
\end{proof}

Note that the above proof does not give a proof that the ladder
index of the distance-$2$ formula is at most $2(t-1)$. In the type
tree we have the stronger statement that the vertices $b_i$
are not connected by a path of length $2$. 
We make no statement about the connections
of these elements in the ladder. 

\begin{theorem}
The function $N$ in the definition of uniform quasi-wideness
is small.
\end{theorem}
\begin{proof}
Assume $K_t\not\minor_2G$, in particular, $G$ excludes $K_t$
as a subgraph. We take a large independent subset $A'$ of $A$ and
enumerate it as $(a_1,\ldots, a_m)$. We build the type
tree, which has depth at least $x$ according to \cref{lem:depth}. 
We consider the longest branch of the type tree. On this branch, 
we take a set $X$ of maximum length such that every vertex has 
all its successors on the same side. This set has size at least
half the length of the branch. 

Either, $X$ is a set with all its successors on the left, then $X$ 
is a $2$-independent set and we are done with this step and
continue with $X$. Otherwise, all vertices of $X$ are at distance
$2$. Let $m=X$ and assume that $m$ is larger than $n_0$ to
be defined for neighbourhood complexity.
We claim that we find an element which is connected to at least $m^{1/3}$
of the vertices of $X$. Otherwise, every vertex
can create only $m^{2/3}$ connections, however, we need
to create $m^2$ connections. Hence, we need $m^{4/3}$ vertices
to create all connections. We have neighbourhood complexity
$m^{1+\epsilon}$ though, a contradiction. 

We delete the element of degree $m^{1/3}$ 
and continue with the subsequence
induced by its neighbours. This can happen at most 
$t(2)$ times, as we are constructing a complete minor at 
depth $2$ here. 
\end{proof}

