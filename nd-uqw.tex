\section{From nowhere denseness to uniform quasi-wideness}\label{sec:uqw}

This section is devoted to the proof of \cref{thm:new-uqw}. 
In the presentation we focus on proving the existential statement, and at the end we briefly argue how the proof can be turned into an algorithm with the promised running time guarantee.
We first recall necessary preliminaries from graph theory. 

\paragraph*{Preliminaries.}
All graphs in this paper are finite, undirected and simple, that is, 
they do not have loops or parallel edges. Our notation is standard,
we refer to~\cite{diestel2012graph} for more background on 
graph theory. 
We write $V(G)$ for the vertex set of a graph $G$ and
$E(G)$ for its edge set. 
The {\em{distance}} between vertices $u$ and $v$ in $G$, denoted $\dist_G(u,v)$, is the length of a shortest path between $u$ and $v$ in~$G$.
If there is no path between $u$ and $v$ in $G$, we put $\dist_G(u,v)=\infty$.
For a vertex $u$ and nonnegative integer $s$, by $N_s[u]$ we denote the {\em{$s$-neighborhood of $u$}} which comprises vertices at distance at most $s$ from $u$.

A {\em{minor model}} of a graph $H$ in $G$ is a family $(I_u)_{u\in V(H)}$ of pairwise vertex-disjoint connected subgraphs of $G$, called {\em{branch sets}},
such that whenever $uv$ is an edge in~$H$, there are $u'\in I_u$ and $v'\in I_v$ for which $u'v'$ 
is an edge in $G$.
The graph $H$ is a {\em{depth-$r$ minor}} of $G$, denoted $H\minor_rG$, if there is a minor model
$(I_u)_{u\in V(H)}$ of~$H$ in $G$ such that each $I_u$ has radius at most $r$.

A class $\CCC$ of graphs is \emph{nowhere dense} if there is a function 
$t\colon \N\rightarrow \N$ such that for all $r\in \N$ it holds that $K_{t(r)}\not\minor_r G$
for all $G\in \CCC$. 

A set $B\subseteq V(G)$ is called {\em{$r$-independent}} in a graph $G$ if for all
distinct $u,v\in B$ we have $\dist_G(u,v)>r$.
A class $\CCC$ of graphs is \emph{uniformly quasi-wide} if there are
functions $N\colon \N\times\N\rightarrow \N$ and $s:\N\rightarrow \N$ such
that for all $r,m\in \N$, all graphs $G\in \CCC$, and all subsets $A\subseteq V(G)$ of size $\abs{A}\geq N(r,m)$, there is a set
$S\subseteq V(G)$ of size $\abs{S}\leq s(r)$ and a set
$B\subseteq A\setminus S$ of size $\abs{B}\geq m$ which is $r$-independent in
$G-S$. 



\begin{proof}[of \cref{thm:new-uqw}]
  If $U$ is a set, then
  a \emph{binary tree}  with labels in $U$
  is a partial function  $\tau\from \set{0,1}^*\to U$ whose domain is a finite set of binary words which is closed under taking prefixes. The \emph{size} of a tree is the cardinality of its domain. The \emph{empty} tree is the tree of size $0$. The \emph{height} of a nonempty tree is the length of the longest word in its domain.
  
  Let $G$ be a graph, $A\subset V(G)$ a set of its vertices
  and $\bar a$ an enumeration of $A$.

We define  a binary tree $\tau$ which is 
  labeled by pairs consisting 
  of a vertex $a$ which is an element of $\bar a$ and a connected subgraph of~$G$.
 For any such tree $\tau$, 
  whenever $\tau(w)$ is defined,
   let $v_\tau(w)$ 
  and $B_\tau(w)$ 
  denote the first and the second component of $\tau(w)$, respectively. 
  
  The structure $\tau$ is defined by processing all elements of the sequence $\bar a$ in sequentially. We start with $\tau$ being the empty tree, and for each element $a$ of the sequence $\bar a$, execute the following procedure, which extends the domain of $\tau$ by one element.
  
When processing the vertex $a$, do the following. Start with $w$ being the empty word and $B$ the graph with only the vertex $a$. While $\tau(w)$ is defined, repeat the following step.
  Let $b=v_\tau(w)$ and let $R=B\cup \bigcup_{v\le w}B_\tau(w)$,
  where $v\le w$ denotes that $v$ is a prefix of $w$.
  If the distance from $a$ to $b$ in the graph 
  $G-R$ is at most $r$, replace $w$ by $w0$ and add to $B$ a path of length at most $r-1$ joining $a$ with some neighbour of $b$ in $G-R$. Otherwise, replace $w$ by $w1$.
  Repeat the step, unless $\tau(w)$ is undefined. 
  Once $\tau(w)$ is undefined, extend $\tau$ to $w$    so that  $v_{\tau}(w)=a$ and $B_{\tau}(w)=B$.
  Note that $B_\tau(w)$ has radius at most $r$ centered at $a$,  is disjoint from $B_\tau(v)$ for every prefix $v$ of $w$, and contains at most $r\cdot k$ vertices, where $k$ is the number of $0$'s in $w$.  
  
  We have processed the element $a$, and now
    proceed to the next element $a$ of $\bar a$, until all elements are processed. This ends the construction of $\tau$.
  
  
  \medskip
  
  From now on, assume that $K_{t+1}\not\minor_r G$.   
  % Let $A\subset V(G)$ and let $\bar a$ be
  % an enumeration of $A$.
  % Consider the tree $\tau$  as defined above.
\begin{claim}
The domain of $\tau$ consists of words with at most $t$ occurrences of the letter $0$. 
\end{claim}
\begin{clproof}
  Observe that if $\tau(w)$ is defined and $w$ has $l$ occurrences of the letter $0$, then $G$ contains a clique on $l$ vertices as  a minor at depth $r$:
  the vertices of the clique are the words $u$ 
such that $u0$ is a prefix of $w$,
  and the branch set associated to $u$ 
  is $B_\tau(u)$.
\end{clproof}


\begin{claim}\label{cl:right-words}
  The  tree $\tau$  has size at most $h^{t+1}$, where $h$ is its height.
\end{claim}
\begin{clproof}
The number of words of length at most $h$ and with at most $t$ occurrences of the letter $0$ is at most $h^{t+1}$.
\end{clproof}

  
Suppose that
  $|A|>(t\cdot (m+1))^{t+1}$. By~\cref{cl:right-words},  
  the height of $\tau$ is larger than $t\cdot (m+1)$, i.e.,
  there is a word $w$ of length larger than $t\cdot (m+1)$ in the domain of $\tau$. Since $w$ has at most $t$ occurrences of the letter~$0$, it  must contain a block of $m$ consecutive $1$'s, i.e., there is a word $u$ such that $u1^k$ is a prefix of $w$, for $k=1,\ldots,m$.
Let $B$ be the set of corresponding vertices, i.e., $B=\set{v_\tau(u1^k):k=1,\ldots,m}$,
and let $S$ be the set of vertices occurring in some $B_\tau(v)$, for some prefix $v$ of $u$.
It follows by construction that $B$ is a subset of $A$ which is $r$-independent in $G-S$.  Moreover, $|B|=m$ and 
$S$ contains at most $r\cdot t^2$ vertices.
  \end{proof}
  
  
  
  

\section{VC dimension}\label{sec:vc}

We now come to the proof of \cref{thm:new-vc}. A set $X$ of vertices 
in a graph is \emph{shattered} if for every
subset $Y\subseteq X$ there exists 
a vertex $v$ such that $N[v]\cap X=Y$. The \emph{Vapnik-Chervonenkis dimension}, short \emph{VC-dimension}~\cite{chervonenkis1971theory} of a graph is the maximum size of a shattered set. 
The VC-dimension as a measure of complexity of set systems found has many applications, e.g.\ in learnability theory~\cite{haussler1987}, computational geometry~\cite{chazelle1989quasi},
and graph theory~\cite{alon2006dominating,BousquetT15,chepoi2007covering,eickmeyer2016neighborhood}.
We define notions of a {\em{$2$-shattered}} set and the {\em{2VC-dimension}} of a graph by restricting subsets $Y\subseteq X$ considered in the definition only to subsets of size exactly $2$.

The \emph{$r$th power of a graph $G$} is the graph $G^r$
with vertex set $V(G)$, where there is an edge between two 
vertices $u$ and $v$ if and only if their distance in $G$ is at most $r$. 

We observe that an argument of Bousquet and 
Thomass\'e~\cite{BousquetT15} can be slightly modified to prove that 
the $2$VC-dimension of the $r$-power graph $G^r$ of a graph $G$
with $K_t\not\minor_r G$ is small. Obviously, the $2$VC-dimension of $G$
bounds its VC-dimension. Hence, we in fact prove the following strengthening of \cref{thm:new-vc} stated in the introduction. 

\begin{theorem}
Let $r\in \N$ and let $G$ be a graph. 
If $K_t\not\minor_r G$, then the $2$VC-dimension of $G^r$
is at most $t-1$. 
\end{theorem}
\begin{proof}
Assume there is a set $A=\{a_1,\ldots, a_t\}$ of size $t$ such that
for all subsets $\{i,j\}\subseteq \{1,\ldots,t\}$ of size $2$ 
there is an vertex $v_{ij}$ with 
$N_r[v_{ij}]\cap A=\{a_i,a_j\}$.
For each subset $\{i,j\}\subseteq \{1,\ldots,t\}$ of size $2$, choose a vertex $u_{ij}$ so that:
\begin{enumerate}[(1)]
\item\label{p:i} $\dist(v_{ij},u_{ij})+\dist(u_{ij},a_i)\leq r$;
\item\label{p:j} $\dist(v_{ij},u_{ij})+\dist(u_{ij},a_j)\leq r$; and
\item\label{p:min} subject to conditions \eqref{p:i} and \eqref{p:j}, $\max(\dist(u_{ij},a_i),\dist(u_{ij},a_j))$ is minimized.
\end{enumerate}
Observe that $u_{ij}$ is well-defined since setting $u_{ij}=v_{ij}$ satisfies the first two conditions.

Let $P^i_{ij}$ and $P^j_{ij}$ be arbitrarily chosen shortest paths between $u_{ij}$ and~$a_i$, and between $u_{ij}$ and~$a_j$, respectively.
We now establish some basic properties of paths $P^i_{ij}$ and $P^j_{ij}$ following from the choice of $u_{ij}$.

\begin{claim}\label{cl:ineq}
For each vertex $x$ on $P^i_{ij}$ we have $\dist(v_{ij},x)+\dist(x,a_i)\leq r$, and
for each vertex $y$ on $P^j_{ij}$ we have $\dist(v_{ij},y)+\dist(y,a_j)\leq r$.
\end{claim}
\begin{clproof}
We prove only the first statement for the second is symmetric.
We have
$$\dist(v_{ij},x)+\dist(x,a_{i})\leq \dist(v_{ij},u_{ij})+\dist(u_{ij},x)+\dist(x,a_{i})=\dist(v_{ij},u_{ij})+\dist(u_{ij},a_{i})\leq r,$$
where the last equality is due to $x$ lying on a shortest path between $u_{ij}$ and $a_i$, and the last inequality is by condition~\eqref{p:i}.
\end{clproof}

\begin{claim}\label{cl:closer}
Suppose $x$ is a vertex on $P^i_{ij}$ that is different from $u_{ij}$. Then $\dist(x,a_i)<\dist(x,a_j)$.
Symmetrically, if $y$ lies on $P^j_{ij}$ and is different from $u_{ij}$, then $\dist(y,a_i)>\dist(y,a_j)$.
Consequently, paths $P^i_{ij}$ and $P^j_{ij}$ share only one vertex, being the endpoint $u_{ij}$.
\end{claim}
\begin{clproof}
We prove only the first claim, for the second is symmetric and the third directly follows from the first two.
Suppose for contradiction that $\dist(x,a_i)\geq \dist(x,a_j)$.
By \cref{cl:ineq} we have 
$$\dist(v_{ij},x)+\dist(x,a_i)\leq r.$$
On the other hand, since $\dist(x,a_i)\geq \dist(x,a_j)$, we have
$$\dist(v_{ij},x)+\dist(x,a_j)\leq\dist(v_{ij},x)+\dist(x,a_i)\leq r.$$
We conclude that $x$ satisfies conditions \eqref{p:i} and \eqref{p:j} from the definition of $u_{ij}$.
However, since $x\neq u_{ij}$ and $x$ lies on a shortest path between $u_{ij}$ and $a_i$, we have $\dist(x,a_i)<\dist(u_{ij},a_i)$.
Therefore,
$$\dist(x,a_j)\leq \dist(x,a_i)<\dist(u_{ij},a_i)\leq \max(\dist(u_{ij},a_i),\dist(u_{ij},a_j)).$$
Thus, the existence of $x$ contradicts condition \eqref{p:min} from the definition of $u_{ij}$.
\end{clproof}

Now, define paths $Q^i_{ij}$ and $Q^j_{ij}$ as follows:
\begin{itemize}
\item if $\dist(u_{ij},a_i)<\dist(u_{ij},a_j)$, then $Q^{i}_{ij}=P^{i}_{ij}$ and $Q^{j}_{ij}=P^{j}_{ij} - \{u_{ij}\}$;
\item if $\dist(u_{ij},a_i)>\dist(u_{ij},a_j)$, then $Q^{i}_{ij}=P^{i}_{ij} - \{u_{ij}\}$ and $Q^{j}_{ij}=P^{j}_{ij}$;
\item if $\dist(u_{ij},a_i)=\dist(u_{ij},a_j)$, then define $Q^i_{ij}$ and $Q^j_{ij}$ using any of the above.
\end{itemize}
Thus, by \cref{cl:closer} we have that paths $Q^{i}_{ij}$ and $Q^{j}_{ij}$ are disjoint. Moreover, for each vertex $x$ on $Q^{i}_{ij}$ we have $\dist(x,a_i)\leq \dist(x,a_j)$, and for each
vertex $y$ on $Q^{j}_{ij}$ we have $\dist(y,a_i)\geq \dist(y,a_j)$.

\begin{claim}\label{cl:intersect}
Let $\{i,j\}$ and $\{i',j'\}$ be two different subsets of size $2$ of $\{1,\ldots,t\}$.
Suppose that paths $Q^i_{ij}$ and $Q^{i'}_{i'j'}$ intersect.
Then $i=i'$.
\end{claim}
\begin{clproof}
Let $x$ be a vertex lying both on $Q^i_{ij}$ and $Q^{i'}_{i'j'}$. We first consider the corner case when $x=u_{ij}$.
Suppose first that $\dist(v_{ij},x)\geq \dist(v_{i'j'},x)$. Then by \cref{cl:ineq} we have
$$\dist(v_{i'j'},a_i)\leq \dist(v_{i'j'},x)+\dist(x,a_i)\leq \dist(v_{ij},x)+\dist(x,a_i)\leq r,$$
and analogously $\dist(v_{i'j'},a_{j})\leq r$. However, we assumed that $a_{i'}$ and $a_{j'}$ are the only vertices of~$A$ that are at distance at most $r$ from $v_{i'j'}$, hence $\{i,j\}=\{i',j'\}$,
a contradiction. Suppose then that $\dist(v_{ij},x)<\dist(v_{i'j'},x)$. 
Then we have
$$\dist(v_{ij},a_{i'})\leq \dist(v_{ij},x)+\dist(x,a_{i'})<\dist(v_{i'j'},x)+\dist(x,a_{i'})\leq r,$$
where the last equality follows from \cref{cl:ineq}.
Since $a_i$ and $a_j$ are the only vertices of $A$ that are at distance at most $r$ from $v_{ij}$, we infer that $i'\in \{i,j\}$. 
If $i'=i$ then we would be done, so suppose $i'=j$.
Since $x=u_{ij}$ and $x$ lies on $Q^i_{ij}$, by the definition of $Q^i_{ij}$ we have that $\dist(x,a_i)\leq \dist(x,a_j)=\dist(x,a_{i'})$. Therefore,
$$\dist(v_{i'j'},a_i)\leq \dist(v_{i'j'},x)+\dist(x,a_{i})\leq \dist(v_{i'j'},x)+\dist(x,a_{i'})\leq r.$$
where the last inequality follows from \cref{cl:ineq}.
Again, we assumed that $a_{i'}$ and $a_{j'}$ are the only vertices of $A$ that are at distance at most $r$ from $v_{i'j'}$, so $i\in \{i',j'\}$. If $i=i'$ then we are done, and otherwise we have $i=j'$.
Together with $i'=j$ this implies $\{i,j\}=\{i',j'\}$, a contradiction.

The second corner case when $x=u_{i'j'}$ leads to a contradiction in a symmetric manner.

We now move to the main case when $x\neq u_{ij}$ and $x\neq u_{i'j'}$.
Then by \cref{cl:closer} we have $\dist(x,a_i)<\dist(x,a_j)$ and $\dist(x,a_{i'})<\dist(x,a_{j'})$.
By symmetry, without loss of generality assume that $\dist(x,a_i)\leq \dist(x,a_{i'})$.
Observe now that
$$\dist(v_{i'j'},a_i)\leq \dist(v_{i'j'},x)+\dist(x,a_{i})\leq \dist(v_{i'j'},x)+\dist(x,a_{i'})\leq r,$$
where the last inequality follows from \cref{cl:ineq}.
Since we assumed that $a_{i'}$ and $a_{j'}$ are the only vertices of $A$ that are at distance at most $r$ from $v_{i'j'}$, we have $i\in \{i',j'\}$.
However, it cannot happen that $i=j'$, because $\dist(x,a_{i'})<\dist(x,a_{j'})$ and $\dist(x,a_{i'})\geq \dist(x,a_{i})$. We conclude that $i=i'$.
\end{clproof}

For each $i\in \{1,2,\ldots,t\}$ we define $X_i$ to be the union of vertex sets of paths $Q^i_{ij}$ for $j\neq i$.
Each of these paths has length at most $r$ and has $a_i$ as an endpoint, hence the subgraph induced by $X_i$ is connected and has radius at most $r$.
By \cref{cl:intersect}, sets $X_i$ are pairwise disjoint. Finally, observe that for each $\{i,j\}\subseteq \{1,\ldots,t\}$ with $i\neq j$, there is an edge between a vertex of $Q^{i}_{ij}$ and a vertex of $Q^{j}_{ij}$.
We conclude that $(X_i)_{i=1,\ldots,t}$ is a depth-$r$ minor model of $K_t$ in $G$, a contradiction.
\end{proof}

\begin{comment}
\begin{proof}
Assume there is a set $A=\{a_1,\ldots, a_t\}$ of size $t$ such that
for all subsets $\{a_i,a_j\}\subseteq A$ of size $2$ 
there is an element $v_{ij}\in V(G)\setminus A$ with 
$N_r[v_{ij}]\cap A=\{a_i,a_j\}$. Fix such $v_{ij}$ with the property
that $\max\left(\dist_G(v_{ij},a_i), \dist_G(v_{ij},a_j)\right)$ is 
minimized. 

A \emph{central walk} $W_{ij}$ is the concatenation of a minimum length
path $P_{ij}^i$ from $a_i$ to $v_{ij}$ and a minimum length path $P_{ij}^j$ from $v_{ij}$ to $a_j$. 
Note that a central walk is possibly not a path. For each pair $a_i,a_j$ fix
a central walk $W_{ij}$ and the corresponding paths $P_{ij}^i$ and $P_{ij}^j$. 

Now assume that a vertex $x$ is traversed by two different central 
walks $W_{ij}$, $W_{i'j'}$. By swapping indices if necessary, assume that $x$ lies on $P_{ij}^i$ and $P_{i'j'}^{i'}$. 

First, observe that if $\dist(x,a_i)=\dist(x,a_{i'})$, 
then $a_i=a_{i'}$. Indeed, if $\dist(x,a_i)=\dist(x,a_{i'})$ then $\dist(v_{ij},a_{i})=\dist(v_{ij},a_{i'})$, so $i'\in \{i,j\}$ because $a_i,a_j$ are the only vertices of $A$ at distance at most $r$ from $v_{ij}$.
Analogously $i\in \{i',j'\}$, so either $i=i'$, or $i'=j$ and $i=j'$. However, the latter case would imply $\{i,j\}=\{i',j'\}$, which contradicts the assumption that $W_{ij}$ and $W_{i'j'}$ are distinct. 

A similar argument yields that
$\dist(x,a_i)<\dist(x,a_j)$ 
and $\dist(x,a_{i'})<\dist(x,a_{j'})$. 
Now assume that $\dist(x,a_i)<\dist(x,a_{i'})$. By the same argument as 
above we have $a_{j'}=a_i$, hence $W_{i'j'}=W_{ij'}$. Here, we have
$\dist(x,a_i)<\dist(x,a_j)$ and $\dist(x,a_{i})<\dist(x,a_{i'})$, 
otherwise the walks are not distinct. 

Let us now construct connected subsets $X_i$ for all $1\leq i\leq t$. 
For every walk $W_{ij}$ the vertices of $W_{ij}$ closer to $a_i$ than to $a_j$ 
are added to $X_i$, the vertices of $W_{ij}$ closer to $a_j$ than to $a_i$ 
are added to $X_j$, ties are broken arbitrary.
Then the sets $X_i$ are pairwise disjoint by what we proved above. If a vertex $x$
appears in two distinct central walks, these are $W_{ij}$ and $W_{i\ell}$ for some
$i,j,\ell$ with $\dist(x,a_i)<\dist(x,a_j)$ and $\dist(x,a_i)<\dist(x,a_\ell)$. 
In both cases $x$ belongs to $X_i$. By construction, the sets $X_i$ are connected, 
have radius at most~$r$, and 
there is always an edge between a vertex of $X_i$ and a vertex of $X_j$ since $X_i\cup X_j$ 
contains the walk $W_{ij}$. Therefore, if the $2$VC-dimension is at least $t$, the 
graph contains $K_t$ as a depth-$r$ minor. 
\end{proof}
\end{comment}